# Couchbase

## 1. Развернуть кластер couchbase

Для развертывания кластера использовался docker-compose.yaml. Поднимались 4 ноды.

Комадна для запуска:

```bash
docker compose up -d
```

После этого создали кластер через UI интерфейс.
Подключался к 4-й ноде. И создал кластер.

![alt text](<Cluster_settings.png>)

Для тестового запуска оставил дефолтный настройки кластера.
Далее для каждой ноды с 1 по 3 подключился уже к существующему кластеру через UI интерфейс.


## 2. Создать БД, наполнить небольшими тестовыми данными

Для проверки работоспособности кластера использовал Sample-bucket - `gamesim-sample`.

После заполениня данными подключился через DataGrip через пор `11210` к локально, развернотому кластеру.
После этого выполнел простейший SQL запрос,
на отображение имеющихся в базе данных.

```sql
SELECT * FROM `gamesim-sample`
```

## 3. Проверить отказоустойчивость.

На первом шаге были подключены 3 ноды к кластеру, далее была выполнена ребланасировка.

После этого были проведены тесты по остановке работы нод через команду:

```bash
docker compose stop <node_name>
```

После этого при остановки ноды, производилась либо ручная перебалансировка или автоматическая через 120 секунд после подения ноды.

После этого был проведён эксперемент по выделению ноде, одной функциональности.
Эксперемент будет проводиться с использованием запроса

```sql
SELECT * FROM `gamesim-sample` where name = "Aaron0";
```

По шаговое выполнение:

1) Создать кластер с нодой, у которой отключена функция индексирования. Таким образом создание индекса и использования индекса при запросах в данном кластере будет не возможно. План запроса.
![alt text](<Plan_without_index.png>)
2) Подключить новую node только для `index`
![alt text](<Index_settings.png>)
3) Проведена ребалансировка кластера
4) После этого создадим простой индекс на `name`.

```sql
CREATE INDEX name_idx ON `gamesim-sample` (name);
```

5) После этого план запроса использует индекс, который реализован на второй ноде.
![alt text](<Plan_with_index.png>)

### Итоги

`Couchbase` - отличный инструмент, который находит применение в высоко-нагруженных облостях. Некоторые плюсы данной базы, который в значительно степени хотелось бы выделить.

* Удобной UI - для конфигурации кластера и нод.
* Модульность БД - за счёт того, что мы можем давать некий профиль `node` мы во много можем распределить высокую нагрузку, добавить ноды на те места в БД, которые являются узкими. Таким образом можно достичь достаточно высокой эффективности.
